<!DOCTYPE html>
{% load staticfiles %}
<html>

  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" onError="this.onerror=null;this.href='{% static 'knowledge_storage/css/bootstrap.min.css' %}';">
    <link rel="stylesheet" href="{% static 'knowledge_storage/css/main.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.css" type="text/css" media="all" onError="this.onerror=null;this.href='{% static 'knowledge_storage/css/jquery-ui.css' %}';">
  </head>
  <input type="hidden" id="refreshed" value="no">

  <body>

    {% if messages %}
    <div class="messages">
        <div class="b-popup-content">
            {% for message in messages %}
            <p><b>{{ message }}</b></p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <header id="header">
        <div class="header-nav">
            <ul>
                <li id="home">
                    <a href="{% url 'home' %}">Home</a>
                </li>
                <li><a href="{% url 'contact' %}">Contact</a></li>
                {% if request.user.is_authenticated %}
                    <li><a href="{% url 'logout' %}?next={{request.path}}">Logout</a></li>
                    <li><a href="{% url 'edit_profile' %}?next={{request.path}}">{{request.user.username}}</a></li>
                {% else %}
                    <li><a href="{% url 'login' %}?next={{request.path}}">Login</a></li>
                    <li><a href="{% url 'register' %}?next={{request.path}}">Sign up</a></li>
                {% endif %}
            </ul>
        </div>

        <nav class="subnav">
            <ul class="site-navigation">
                <li class="navitem"><a href="{% url 'learn_options' %}">Learn</a></li>
                <li class="navitem"><a href="{% url 'check_options' %}">Check</a></li>
                <li class="navitem"><a href="{% url 'note_options' %}">Note</a></li>
            </ul>
        </nav>
    </header>

    <div class="personal_notes">
        <div class="container">
            <h1>Personal notes</h1>
            <h2>It is always a good idea to make notes when you are studying. Store your notes remotely and they will
                be available anytime and anywhere.</h2>
            <div id="note_img">
                <img src="{% static 'knowledge_storage/img/learn_options_img3.jpg' %}" alt="Image not found">
            </div>
            <div id="notes">
                <form action="{% url 'search_notes' %}" method="GET">
                    {% csrf_token %}
                    {{ form.non_field_errors }}
                    <div class="field_wrapper">
                        {{ form.subject.errors }}
                        <label for="{{ form.subject.id_for_label }}">Subject:</label>
                        {{ form.subject }}
                    </div>
                    <div class="field_wrapper">
                        {{ form.topic.errors }}
                        <label for="{{ form.topic.id_for_label }}">Topic:</label>
                        {{ form.topic }}
                    </div>
                    <p id="submit"><input type="submit" class="btn btn-primary btn-sm" value="Search"></p>
                </form>
                <div id="add_note">
                  <a href="{% url 'add_note' %}?next={{request.path}}"><button type="button" class="btn btn-primary">Add note</button></a>
                </div>
                {% if query %}
                    <div id="results">
                        <p id="t_id">{{ type_id|escape }}</p>
                        <h2><b><ins>Results:</ins></b></h2>
                        {% if topic_results %}
                            {% if user %}
                                <p class="notes_checkbox"><label><input type="checkbox" name="users_only" id="users_notes_main"> Only my notes</label></p>
                                <input type="hidden" id="current_user" value={{ user }}>
                            {% endif %}
                            <div style="overflow-x:auto;">
                                <table id="main_table">
                                   <tr>
                                       <th>Subject</th>
                                       <th>Topic</th>
                                       <th>Author</th>
                                       <th>Date</th>
                                       <th>Likes</th>
                                       <th>Dislikes</th>
                                   </tr>
                                   {% for note in topic_results %}
                                       <tbody>
                                           <tr id="{{ note.id|escape }}">
                                               <td>{{ note.subject|escape }}</td>
                                               <td><a class="note_topic" href="{% url 'show_note' %}?id={{note.id}}">{{ note.topic|escape }}</a></td>
                                               <td class="author">{{ note.user|escape }}</td>
                                               <td>{{ note.date|date:"N j, Y H:i:s" }}</td>
                                               {% if note.like_pressed %}
                                                  <td><a href="javascript: void(0)" class="like pressed"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike plain"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% elif note.dislike_pressed %}
                                                  <td><a href="javascript: void(0)" class="like plain"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike pressed"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% else %}
                                                  <td><a href="javascript: void(0)" class="like plain"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike plain"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% endif %}
                                           </tr>
                                       </tbody >
                                   {% endfor %}
                                </table>
                            </div>
                        {% else %}
                            <p>No notes found</p>
                        {% endif %}
                        {% if body_results %}
                            <br />
                            <h2><b><ins>You may also find these notes useful:</ins></b></h2>
                            {% if user %}
                                <p class="notes_checkbox"><label><input type="checkbox" name="users_only" id="users_notes_secondary"> Only my notes</label></p>
                                <input type="hidden" id="current_user" value={{ user }}>
                            {% endif %}
                            <div style="overflow-x:auto;">
                                <table id="secondary_table">
                                   <tr>
                                       <th>Subject</th>
                                       <th>Topic</th>
                                       <th>Author</th>
                                       <th>Date</th>
                                       <th>Likes</th>
                                       <th>Dislikes</th>
                                   </tr>
                                   {% for note in body_results %}
                                       <tbody>
                                           <tr id="{{ note.id|escape }}">
                                               <td>{{ note.subject|escape }}</td>
                                               <td><a class="note_topic" href="{% url 'show_note' %}?id={{note.id}}">{{ note.topic|escape }}</a></td>
                                               <td class="author">{{ note.user|escape }}</td>
                                               <td>{{ note.date|date:"N j, Y H:i:s" }}</td>
                                               {% if note.like_pressed %}
                                                  <td><a href="javascript: void(0)" class="like pressed"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike plain"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% elif note.dislike_pressed %}
                                                  <td><a href="javascript: void(0)" class="like plain"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike pressed"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% else %}
                                                  <td><a href="javascript: void(0)" class="like plain"><img src='{% static 'knowledge_storage/img/like.png' %}'><span>{{ note.likes }}</span></a></td>
                                                  <td><a href="javascript: void(0)" class="dislike plain"><img src='{% static 'knowledge_storage/img/dislike.png' %}'><span>{{ note.dislikes }}</span></a></td>
                                              {% endif %}
                                           </tr>
                                       </tbody >
                                   {% endfor %}
                                </table>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="{% static 'knowledge_storage/js/jquery-2.2.2.min.js' %}"><\/script>')</script>
    <script src="{% static 'knowledge_storage/js/jquery-ui.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'knowledge_storage/js/common.js' %}"></script>
    <script src="{% static 'knowledge_storage/js/main.js' %}"></script>
    <script src="{% static 'knowledge_storage/js/note_options.js' %}"></script>
  </body>
</html>
